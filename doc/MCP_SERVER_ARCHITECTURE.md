# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ MCP –°–µ—Ä–≤–µ—Ä–∞: –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –¥–ª—è –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

–ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é MCP (Model Context Protocol) —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ C++20. –≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ tree-sitter-mcp –∏ –æ–ø–∏—Å—ã–≤–∞–µ—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ MCP —Å–µ—Ä–≤–µ—Ä–∞.

---

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–û–±–∑–æ—Ä MCP –ü—Ä–æ—Ç–æ–∫–æ–ª–∞](#–æ–±–∑–æ—Ä-mcp-–ø—Ä–æ—Ç–æ–∫–æ–ª–∞)
2. [–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –†–µ–∞–ª–∏–∑–∞—Ü–∏–∏](#—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è-–∫-—Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏)
3. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¢—Ä—ë—Ö –°–ª–æ—ë–≤](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-—Ç—Ä—ë—Ö-—Å–ª–æ—ë–≤)
4. [–ü—Ä–æ—Ç–æ–∫–æ–ª –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏](#–ø—Ä–æ—Ç–æ–∫–æ–ª-–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏)
5. [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ü—Ä–æ–µ–∫—Ç–∞](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç–∞)
6. [–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞](#—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è-—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞)
7. [–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –°–µ—Ä–≤–µ—Ä–∞](#—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è-—Å–µ—Ä–≤–µ—Ä–∞)
8. [–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤](#—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤)
9. [–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Claude Code](#–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è-—Å-claude-code)
10. [–ü—Ä–∏–º–µ—Ä—ã –ö–æ–¥–∞](#–ø—Ä–∏–º–µ—Ä—ã-–∫–æ–¥–∞)
11. [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](#—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)

---

## –û–±–∑–æ—Ä MCP –ü—Ä–æ—Ç–æ–∫–æ–ª–∞

### –ß—Ç–æ —Ç–∞–∫–æ–µ MCP?

**Model Context Protocol (MCP)** ‚Äî —ç—Ç–æ –æ—Ç–∫—Ä—ã—Ç—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–≤ —Å –≤–Ω–µ—à–Ω–∏–º–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏ –∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö. –†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω Anthropic –¥–ª—è Claude Code –∏ –¥—Ä—É–≥–∏—Ö AI-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π.

### –ö–ª—é—á–µ–≤—ã–µ –ö–æ–Ω—Ü–µ–ø—Ü–∏–∏

- **–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç**: –ú–µ—Ö–∞–Ω–∏–∑–º –ø–µ—Ä–µ–¥–∞—á–∏ —Å–æ–æ–±—â–µ–Ω–∏–π (stdio, HTTP/SSE, WebSocket)
- **JSON-RPC 2.0**: –ü—Ä–æ—Ç–æ–∫–æ–ª –æ–±–º–µ–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
- **–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã (Tools)**: –§—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ AI –º–æ–∂–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å
- **–†–µ—Å—É—Ä—Å—ã (Resources)**: –î–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ AI –º–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- **–ü—Ä–æ–º–ø—Ç—ã (Prompts)**: –®–∞–±–ª–æ–Ω—ã –¥–ª—è AI (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –í–µ—Ä—Å–∏—è –ü—Ä–æ—Ç–æ–∫–æ–ª–∞

–¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è: **2024-11-05**

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: https://spec.modelcontextprotocol.io/

---

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –†–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

1. **–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã–π —Å–ª–æ–π**: Stdio (stdin/stdout) ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–π
2. **JSON-RPC 2.0**: –°–µ—Ä–≤–µ—Ä –¥–æ–ª–∂–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å JSON-RPC –∑–∞–ø—Ä–æ—Å—ã
3. **–ú–µ—Ç–æ–¥ initialize**: –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ô –¥–ª—è handshake —Å –∫–ª–∏–µ–Ω—Ç–æ–º
4. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ notifications/initialized**: –ü—Ä–∏–Ω–∏–º–∞—Ç—å –±–µ–∑ –æ—Ç–≤–µ—Ç–∞
5. **–•–æ—Ç—è –±—ã –æ–¥–Ω–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å**: Tools, Resources –∏–ª–∏ Prompts

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **C++20** –∏–ª–∏ –Ω–æ–≤–µ–µ (–¥–ª—è concepts, ranges, designated initializers)
- **nlohmann/json**: –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å JSON
- **spdlog**: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- **CLI11**: –ü–∞—Ä—Å–∏–Ω–≥ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏
- **CMake 3.20+**: –°–∏—Å—Ç–µ–º–∞ —Å–±–æ—Ä–∫–∏
- **GTest**: –Æ–Ω–∏—Ç-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¢—Ä—ë—Ö –°–ª–æ—ë–≤

### –î–∏–∞–≥—Ä–∞–º–º–∞ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  –°–ª–æ–π 3: MCP Tools (src/tools/)                         ‚îÇ
‚îÇ  ‚îú‚îÄ ParseFileTool                                       ‚îÇ
‚îÇ  ‚îú‚îÄ FindClassesTool                                     ‚îÇ
‚îÇ  ‚îú‚îÄ FindFunctionsTool                                   ‚îÇ
‚îÇ  ‚îî‚îÄ ExecuteQueryTool                                    ‚îÇ
‚îÇ                                                          ‚îÇ
‚îÇ  –ö–∞–∂–¥—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç:                                     ‚îÇ
‚îÇ  - –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π get_info() ‚Üí ToolInfo     ‚îÇ
‚îÇ  - –†–µ–∞–ª–∏–∑—É–µ—Ç execute(args) ‚Üí json result               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                          ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  –°–ª–æ–π 2: MCP Protocol (src/mcp/)                        ‚îÇ
‚îÇ  ‚îú‚îÄ MCPServer                                           ‚îÇ
‚îÇ  ‚îÇ  ‚îú‚îÄ handle_initialize()         [–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û]       ‚îÇ
‚îÇ  ‚îÇ  ‚îú‚îÄ handle_initialized_notification()               ‚îÇ
‚îÇ  ‚îÇ  ‚îú‚îÄ handle_tools_list()                             ‚îÇ
‚îÇ  ‚îÇ  ‚îú‚îÄ handle_tools_call()                             ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ create_error_response()                         ‚îÇ
‚îÇ  ‚îÇ                                                      ‚îÇ
‚îÇ  ‚îú‚îÄ ITransport (abstract interface)                    ‚îÇ
‚îÇ  ‚îî‚îÄ StdioTransport (stdin/stdout)                      ‚îÇ
‚îÇ     ‚îú‚îÄ read_message() ‚Üí json                           ‚îÇ
‚îÇ     ‚îî‚îÄ write_message(json)                             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                          ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  –°–ª–æ–π 1: Core Logic (src/core/)                         ‚îÇ
‚îÇ  ‚îú‚îÄ –í–∞—à–∞ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞                                  ‚îÇ
‚îÇ  ‚îú‚îÄ –ü–∞—Ä—Å–µ—Ä—ã, –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä—ã, –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä—ã                   ‚îÇ
‚îÇ  ‚îî‚îÄ –ù–µ–∑–∞–≤–∏—Å–∏–º—ã–µ –æ—Ç MCP –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã                      ‚îÇ
‚îÇ                                                          ‚îÇ
‚îÇ  –ü—Ä–∏–º–µ—Ä—ã:                                               ‚îÇ
‚îÇ  - TreeSitterParser (tree-sitter wrapper)               ‚îÇ
‚îÇ  - QueryEngine (S-expression queries)                   ‚îÇ
‚îÇ  - ASTAnalyzer (high-level API)                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ü—Ä–∏–Ω—Ü–∏–ø—ã –†–∞–∑–¥–µ–ª–µ–Ω–∏—è

1. **–°–ª–æ–π 1 (Core)**: –ù–µ –∑–Ω–∞–µ—Ç –æ MCP, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ
2. **–°–ª–æ–π 2 (Protocol)**: –†–µ–∞–ª–∏–∑—É–µ—Ç MCP, –Ω–µ –∑–Ω–∞–µ—Ç –æ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–µ
3. **–°–ª–æ–π 3 (Tools)**: –°–≤—è–∑—ã–≤–∞–µ—Ç Core –∏ Protocol

---

## –ü—Ä–æ—Ç–æ–∫–æ–ª –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏

### –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: Handshake Sequence

```
Client (Claude Code)              Server (–≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ)
      ‚îÇ                                    ‚îÇ
      ‚îÇ  1. initialize request             ‚îÇ
      ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ
      ‚îÇ    {                                ‚îÇ
      ‚îÇ      "method": "initialize",        ‚îÇ
      ‚îÇ      "params": {                    ‚îÇ
      ‚îÇ        "protocolVersion": "2024-11-05",
      ‚îÇ        "clientInfo": {...}          ‚îÇ
      ‚îÇ      }                              ‚îÇ
      ‚îÇ    }                                ‚îÇ
      ‚îÇ                                     ‚îÇ
      ‚îÇ  2. initialize response             ‚îÇ
      ‚îÇ<‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
      ‚îÇ    {                                ‚îÇ
      ‚îÇ      "result": {                    ‚îÇ
      ‚îÇ        "protocolVersion": "2024-11-05",
      ‚îÇ        "capabilities": {            ‚îÇ
      ‚îÇ          "tools": {}                ‚îÇ
      ‚îÇ        },                           ‚îÇ
      ‚îÇ        "serverInfo": {              ‚îÇ
      ‚îÇ          "name": "my-server",       ‚îÇ
      ‚îÇ          "version": "1.0.0"         ‚îÇ
      ‚îÇ        }                            ‚îÇ
      ‚îÇ      }                              ‚îÇ
      ‚îÇ    }                                ‚îÇ
      ‚îÇ                                     ‚îÇ
      ‚îÇ  3. notifications/initialized       ‚îÇ
      ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ
      ‚îÇ    {                                ‚îÇ
      ‚îÇ      "method": "notifications/initialized"
      ‚îÇ    }                                ‚îÇ
      ‚îÇ    (NO RESPONSE!)                   ‚îÇ
      ‚îÇ                                     ‚îÇ
      ‚îÇ  4. Normal operation                ‚îÇ
      ‚îÇ  tools/list, tools/call, etc.       ‚îÇ
      ‚îÇ<‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ
```

### –û—à–∏–±–∫–∞ "Method not found: initialize"

–ï—Å–ª–∏ –≤—ã –≤–∏–¥–∏—Ç–µ —ç—Ç—É –æ—à–∏–±–∫—É:
```json
{"error": {"code": -32601, "message": "Method not found: initialize"}}
```

**–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤—å—Ç–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `initialize` –≤ –≤–∞—à `handle_request()` –º–µ—Ç–æ–¥!

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ü—Ä–æ–µ–∫—Ç–∞

### –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –§–∞–π–ª–æ–≤–∞—è –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```
my-mcp-server/
‚îú‚îÄ‚îÄ CMakeLists.txt              # –ö–æ—Ä–Ω–µ–≤–æ–π CMake
‚îú‚îÄ‚îÄ conanfile.txt               # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
‚îú‚îÄ‚îÄ .mcp.json                   # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è Claude Code
‚îú‚îÄ‚îÄ README.md
‚îÇ
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ CMakeLists.txt
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ core/                   # –°–ª–æ–π 1: –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CMakeLists.txt
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ MyCore.hpp
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ MyCore.cpp
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ mcp/                    # –°–ª–æ–π 2: –ü—Ä–æ—Ç–æ–∫–æ–ª
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CMakeLists.txt
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ITransport.hpp      # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ StdioTransport.hpp
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ StdioTransport.cpp
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ MCPServer.hpp       # –û—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–µ—Ä
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ MCPServer.cpp
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ tools/                  # –°–ª–æ–π 3: –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CMakeLists.txt
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ MyTool.hpp
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ MyTool.cpp
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ main_stdio.cpp          # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îÇ
‚îú‚îÄ‚îÄ tests/                      # –¢–µ—Å—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ CMakeLists.txt
‚îÇ   ‚îú‚îÄ‚îÄ core/
‚îÇ   ‚îú‚îÄ‚îÄ mcp/
‚îÇ   ‚îî‚îÄ‚îÄ tools/
‚îÇ
‚îî‚îÄ‚îÄ doc/                        # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
    ‚îî‚îÄ‚îÄ MCP_API_REFERENCE.md
```

### –§–∞–π–ª .mcp.json (–¥–ª—è Claude Code)

```json
{
  "mcpServers": {
    "my-server": {
      "command": "/usr/local/bin/my-mcp-server",
      "args": ["--log-level", "info"]
    }
  }
}
```

---

## –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞

### ITransport.hpp - –ê–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å

```cpp
#pragma once
#include <nlohmann/json.hpp>

namespace my_mcp {

using json = nlohmann::json;

/**
 * @brief –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–æ–≥–æ —Å–ª–æ—è MCP
 *
 * –†–µ–∞–ª–∏–∑–∞—Ü–∏–∏: StdioTransport, SSETransport, WebSocketTransport
 */
class ITransport {
public:
    virtual ~ITransport() = default;

    /**
     * @brief –ü—Ä–æ—á–∏—Ç–∞—Ç—å –æ–¥–Ω–æ JSON-RPC —Å–æ–æ–±—â–µ–Ω–∏–µ
     * @return JSON –æ–±—ä–µ–∫—Ç –∏–ª–∏ null –ø—Ä–∏ EOF
     */
    virtual json read_message() = 0;

    /**
     * @brief –ó–∞–ø–∏—Å–∞—Ç—å JSON-RPC —Å–æ–æ–±—â–µ–Ω–∏–µ
     * @param message JSON –æ–±—ä–µ–∫—Ç –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
     */
    virtual void write_message(const json& message) = 0;

    /**
     * @brief –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–∫—Ä—ã—Ç –ª–∏ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç
     */
    virtual bool is_open() const = 0;
};

} // namespace my_mcp
```

### StdioTransport.hpp - –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è Stdio

```cpp
#pragma once
#include "ITransport.hpp"
#include <iostream>

namespace my_mcp {

/**
 * @brief –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç —á–µ—Ä–µ–∑ stdin/stdout
 *
 * –§–æ—Ä–º–∞—Ç: –û–¥–Ω–æ JSON-—Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–∞ —Å—Ç—Ä–æ–∫—É (newline-delimited JSON)
 *
 * –í–∞–∂–Ω–æ:
 * - –ö–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è '\n'
 * - Stderr –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ª–æ–≥–æ–≤ (–ù–ï stdout!)
 * - EOF –Ω–∞ stdin –æ–∑–Ω–∞—á–∞–µ—Ç –∑–∞–∫—Ä—ã—Ç–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
 */
class StdioTransport : public ITransport {
public:
    StdioTransport() = default;

    json read_message() override {
        std::string line;
        if (!std::getline(std::cin, line)) {
            // EOF –∏–ª–∏ –æ—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è
            return json();
        }

        if (line.empty()) {
            return json();
        }

        try {
            return json::parse(line);
        } catch (const json::parse_error& e) {
            throw std::runtime_error(
                std::string("JSON parse error: ") + e.what()
            );
        }
    }

    void write_message(const json& message) override {
        // –í–ê–ñ–ù–û: –í—Å—ë –≤ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É + '\n'
        std::cout << message.dump() << std::endl;
        std::cout.flush();
    }

    bool is_open() const override {
        return std::cin.good();
    }
};

} // namespace my_mcp
```

**–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:**
- ‚úÖ –õ–æ–≥–∏ –≤ **stderr** (`spdlog` –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ)
- ‚úÖ –°–æ–æ–±—â–µ–Ω–∏—è –≤ **stdout** (—Ç–æ–ª—å–∫–æ JSON)
- ‚úÖ –ö–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–∞ **–æ—Ç–¥–µ–ª—å–Ω–æ–π —Å—Ç—Ä–æ–∫–µ**
- ‚ùå –ù–ï –ø–∏—à–∏—Ç–µ –Ω–∏—á–µ–≥–æ –∫—Ä–æ–º–µ JSON –≤ stdout!

---

## –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –°–µ—Ä–≤–µ—Ä–∞

### MCPServer.hpp - –û—Å–Ω–æ–≤–Ω–æ–π –ö–ª–∞—Å—Å –°–µ—Ä–≤–µ—Ä–∞

```cpp
#pragma once
#include "ITransport.hpp"
#include <functional>
#include <map>
#include <memory>
#include <atomic>

namespace my_mcp {

/**
 * @brief –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ MCP –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
 */
struct ToolInfo {
    std::string name;
    std::string description;
    json input_schema;  // JSON Schema –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤
};

/**
 * @brief –§—É–Ω–∫—Ü–∏—è-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
 */
using ToolHandler = std::function<json(const json& args)>;

/**
 * @brief MCP –°–µ—Ä–≤–µ—Ä —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π JSON-RPC 2.0
 *
 * –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã:
 * - initialize
 * - notifications/initialized
 * - tools/list
 * - tools/call
 */
class MCPServer {
public:
    explicit MCPServer(std::unique_ptr<ITransport> transport);

    // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
    void register_tool(const ToolInfo& info, ToolHandler handler);

    // –ì–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª —Å–µ—Ä–≤–µ—Ä–∞
    void run();
    void stop();

private:
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤
    json handle_request(const json& request);

    // –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ï –º–µ—Ç–æ–¥—ã –ø—Ä–æ—Ç–æ–∫–æ–ª–∞
    json handle_initialize(const json& params);
    void handle_initialized_notification(const json& params);

    // –ú–µ—Ç–æ–¥—ã –¥–ª—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
    json handle_tools_list();
    json handle_tools_call(const json& params);

    // –£—Ç–∏–ª–∏—Ç—ã
    json create_error_response(const json& id, int code,
                              const std::string& message);

    std::unique_ptr<ITransport> transport_;
    std::map<std::string, ToolInfo> tools_;
    std::map<std::string, ToolHandler> handlers_;
    std::atomic<bool> running_{false};
    bool initialized_{false};
};

} // namespace my_mcp
```

### MCPServer.cpp - –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

```cpp
#include "MCPServer.hpp"
#include <spdlog/spdlog.h>

namespace my_mcp {

MCPServer::MCPServer(std::unique_ptr<ITransport> transport)
    : transport_(std::move(transport)) {
    if (!transport_) {
        throw std::invalid_argument("Transport cannot be null");
    }
    spdlog::info("MCPServer initialized");
}

void MCPServer::register_tool(const ToolInfo& info, ToolHandler handler) {
    if (info.name.empty()) {
        throw std::invalid_argument("Tool name cannot be empty");
    }
    if (!handler) {
        throw std::invalid_argument("Tool handler cannot be null");
    }

    tools_[info.name] = info;
    handlers_[info.name] = std::move(handler);
    spdlog::info("Registered tool: {}", info.name);
}

void MCPServer::run() {
    running_ = true;
    spdlog::info("MCPServer starting main loop");

    while (running_ && transport_->is_open()) {
        try {
            json request = transport_->read_message();

            // EOF –∏–ª–∏ –ø—É—Å—Ç–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
            if (request.empty() || request.is_null()) {
                spdlog::info("Received empty message, stopping server");
                break;
            }

            json response = handle_request(request);

            // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ —Ç—Ä–µ–±—É—é—Ç –æ—Ç–≤–µ—Ç–∞
            if (!response.empty() && !response.is_null()) {
                transport_->write_message(response);
            }

        } catch (const std::exception& e) {
            spdlog::error("Error in main loop: {}", e.what());
        }
    }

    running_ = false;
    spdlog::info("MCPServer stopped");
}

void MCPServer::stop() {
    spdlog::info("MCPServer stop requested");
    running_ = false;
}

json MCPServer::handle_request(const json& request) {
    // –í–∞–ª–∏–¥–∞—Ü–∏—è JSON-RPC 2.0
    if (!request.contains("jsonrpc") || request["jsonrpc"] != "2.0") {
        return create_error_response(
            json(), -32600,
            "Invalid Request: missing or invalid jsonrpc field"
        );
    }

    json id = request.value("id", json());

    if (!request.contains("method")) {
        return create_error_response(
            id, -32600,
            "Invalid Request: missing method field"
        );
    }

    std::string method = request["method"];
    json params = request.value("params", json::object());

    spdlog::debug("Handling request: method={}, id={}",
                  method, id.dump());

    try {
        // –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: initialize –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ü–ï–†–í–´–ú!
        if (method == "initialize") {
            json result = handle_initialize(params);
            initialized_ = true;
            return {
                {"jsonrpc", "2.0"},
                {"id", id},
                {"result", result}
            };
        }
        else if (method == "notifications/initialized") {
            // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ - –ù–ï –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç–≤–µ—Ç
            handle_initialized_notification(params);
            return json();  // –ü—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç
        }
        else if (method == "tools/list") {
            json result = handle_tools_list();
            return {
                {"jsonrpc", "2.0"},
                {"id", id},
                {"result", result}
            };
        }
        else if (method == "tools/call") {
            json result = handle_tools_call(params);
            return {
                {"jsonrpc", "2.0"},
                {"id", id},
                {"result", result}
            };
        }
        else {
            return create_error_response(
                id, -32601,
                "Method not found: " + method
            );
        }
    } catch (const std::exception& e) {
        spdlog::error("Error handling method {}: {}", method, e.what());
        return create_error_response(
            id, -32603,
            std::string("Internal error: ") + e.what()
        );
    }
}

json MCPServer::handle_initialize(const json& params) {
    spdlog::info("Handling initialize request");

    // –õ–æ–≥–∏—Ä—É–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–ª–∏–µ–Ω—Ç–µ
    if (params.contains("clientInfo")) {
        std::string client_name = params["clientInfo"].value("name", "unknown");
        std::string client_version = params["clientInfo"].value("version", "unknown");
        spdlog::info("Client: {} version {}", client_name, client_version);
    }

    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º capabilities —Å–µ—Ä–≤–µ—Ä–∞
    return {
        {"protocolVersion", "2024-11-05"},
        {"capabilities", {
            {"tools", json::object()}  // –ú—ã –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
            // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ:
            // {"resources", json::object()},
            // {"prompts", json::object()}
        }},
        {"serverInfo", {
            {"name", "my-mcp-server"},
            {"version", "1.0.0"}
        }}
    };
}

void MCPServer::handle_initialized_notification(const json& params) {
    spdlog::info("Client sent initialized notification, server is ready");
    // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å post-init –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    // –ù–ï –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –æ—Ç–≤–µ—Ç - —ç—Ç–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ!
}

json MCPServer::handle_tools_list() {
    json tools_array = json::array();

    for (const auto& [name, info] : tools_) {
        tools_array.push_back({
            {"name", info.name},
            {"description", info.description},
            {"inputSchema", info.input_schema}
        });
    }

    spdlog::debug("Returning {} tools", tools_array.size());

    return {
        {"tools", tools_array}
    };
}

json MCPServer::handle_tools_call(const json& params) {
    // –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
    if (!params.contains("name")) {
        throw std::runtime_error("Missing 'name' in tools/call params");
    }

    std::string tool_name = params["name"];
    json arguments = params.value("arguments", json::object());

    spdlog::debug("Calling tool: {}", tool_name);

    // –ü–æ–∏—Å–∫ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞
    auto handler_it = handlers_.find(tool_name);
    if (handler_it == handlers_.end()) {
        throw std::runtime_error("Unknown tool: " + tool_name);
    }

    // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
    json result = handler_it->second(arguments);

    // MCP —Ç—Ä–µ–±—É–µ—Ç —Ñ–æ—Ä–º–∞—Ç —Å "content"
    return {
        {"content", json::array({
            {
                {"type", "text"},
                {"text", result.dump()}
            }
        })}
    };
}

json MCPServer::create_error_response(const json& id, int code,
                                     const std::string& message) {
    return {
        {"jsonrpc", "2.0"},
        {"id", id},
        {"error", {
            {"code", code},
            {"message", message}
        }}
    };
}

} // namespace my_mcp
```

### –ö–æ–¥—ã –û—à–∏–±–æ–∫ JSON-RPC 2.0

| –ö–æ–¥    | –ó–Ω–∞—á–µ–Ω–∏–µ           | –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å                    |
|--------|--------------------|---------------------------------------|
| -32700 | Parse error        | –ù–µ–≤–∞–ª–∏–¥–Ω—ã–π JSON                       |
| -32600 | Invalid Request    | –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç "method" –∏–ª–∏ "jsonrpc"    |
| -32601 | Method not found   | –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –º–µ—Ç–æ–¥                     |
| -32602 | Invalid params     | –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –º–µ—Ç–æ–¥–∞         |
| -32603 | Internal error     | –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞             |

---

## –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤

### –ë–∞–∑–æ–≤–∞—è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞

```cpp
#pragma once
#include "mcp/MCPServer.hpp"
#include "core/MyCore.hpp"
#include <memory>

namespace my_mcp {

/**
 * @brief –ü—Ä–∏–º–µ—Ä MCP –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
 *
 * –ö–∞–∂–¥—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω:
 * 1. –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—Ç—å —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π get_info() —Å JSON Schema
 * 2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å execute(args) ‚Üí json result
 */
class MyTool {
public:
    explicit MyTool(std::shared_ptr<MyCore> core);

    /**
     * @brief –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
     * @return ToolInfo —Å name, description, input_schema
     */
    static ToolInfo get_info();

    /**
     * @brief –í—ã–ø–æ–ª–Ω–∏—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç
     * @param args JSON –æ–±—ä–µ–∫—Ç —Å –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏
     * @return JSON —Ä–µ–∑—É–ª—å—Ç–∞—Ç
     * @throws std::runtime_error –ø—Ä–∏ –æ—à–∏–±–∫–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
     */
    json execute(const json& args);

private:
    std::shared_ptr<MyCore> core_;
};

} // namespace my_mcp
```

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞

```cpp
#include "MyTool.hpp"
#include <spdlog/spdlog.h>

namespace my_mcp {

MyTool::MyTool(std::shared_ptr<MyCore> core)
    : core_(std::move(core)) {
    if (!core_) {
        throw std::invalid_argument("Core cannot be null");
    }
}

ToolInfo MyTool::get_info() {
    return {
        .name = "my_tool",
        .description = "Does something useful with files",
        .input_schema = {
            {"type", "object"},
            {"properties", {
                {"filepath", {
                    {"type", "string"},
                    {"description", "Path to file to process"}
                }},
                {"option", {
                    {"type", "boolean"},
                    {"description", "Optional flag"},
                    {"default", false}
                }}
            }},
            {"required", json::array({"filepath"})}
        }
    };
}

json MyTool::execute(const json& args) {
    // –í–∞–ª–∏–¥–∞—Ü–∏—è –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤
    if (!args.contains("filepath")) {
        throw std::runtime_error("Missing required argument: filepath");
    }

    std::string filepath = args["filepath"];
    bool option = args.value("option", false);

    spdlog::debug("MyTool executing: filepath={}, option={}",
                  filepath, option);

    try {
        // –í—ã–∑–æ–≤ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏
        auto result = core_->process(filepath, option);

        // –í–æ–∑–≤—Ä–∞—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
        return {
            {"success", true},
            {"result", result},
            {"filepath", filepath}
        };

    } catch (const std::exception& e) {
        spdlog::error("MyTool failed: {}", e.what());
        return {
            {"success", false},
            {"error", e.what()},
            {"filepath", filepath}
        };
    }
}

} // namespace my_mcp
```

### JSON Schema –¥–ª—è –í–∞–ª–∏–¥–∞—Ü–∏–∏

MCP –∏—Å–ø–æ–ª—å–∑—É–µ—Ç [JSON Schema](https://json-schema.org/) –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏—è –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤:

```json
{
  "type": "object",
  "properties": {
    "filepath": {
      "type": "string",
      "description": "Path to the file"
    },
    "recursive": {
      "type": "boolean",
      "description": "Scan recursively",
      "default": true
    },
    "patterns": {
      "type": "array",
      "items": {"type": "string"},
      "description": "File patterns (glob)",
      "default": ["*.cpp", "*.hpp"]
    }
  },
  "required": ["filepath"]
}
```

**–¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö:**
- `string`: –°—Ç—Ä–æ–∫–∞
- `number`: –ß–∏—Å–ª–æ (int –∏–ª–∏ float)
- `boolean`: true/false
- `array`: –ú–∞—Å—Å–∏–≤
- `object`: –û–±—ä–µ–∫—Ç
- `null`: Null –∑–Ω–∞—á–µ–Ω–∏–µ

---

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Claude Code

### main_stdio.cpp - –¢–æ—á–∫–∞ –í—Ö–æ–¥–∞

```cpp
#include "core/MyCore.hpp"
#include "mcp/MCPServer.hpp"
#include "mcp/StdioTransport.hpp"
#include "tools/MyTool.hpp"

#include <CLI/CLI.hpp>
#include <spdlog/spdlog.h>
#include <csignal>
#include <memory>
#include <atomic>

namespace {
    std::atomic<bool> shutdown_requested{false};
    my_mcp::MCPServer* global_server = nullptr;

    void signal_handler(int signal) {
        spdlog::info("Received signal {}, shutting down", signal);
        shutdown_requested = true;
        if (global_server) {
            global_server->stop();
        }
    }

    void setup_signal_handlers() {
        std::signal(SIGINT, signal_handler);
        std::signal(SIGTERM, signal_handler);
    }
}

int main(int argc, char** argv) {
    // –ü–∞—Ä—Å–∏–Ω–≥ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤
    CLI::App app{"My MCP Server"};

    std::string log_level = "info";
    app.add_option("-l,--log-level", log_level,
                   "Log level (trace, debug, info, warn, error, critical)")
        ->default_val("info");

    bool version = false;
    app.add_flag("-v,--version", version, "Print version");

    CLI11_PARSE(app, argc, argv);

    if (version) {
        std::cout << "my-mcp-server version 1.0.0" << std::endl;
        return 0;
    }

    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
    if (log_level == "trace") {
        spdlog::set_level(spdlog::level::trace);
    } else if (log_level == "debug") {
        spdlog::set_level(spdlog::level::debug);
    } else if (log_level == "info") {
        spdlog::set_level(spdlog::level::info);
    } else if (log_level == "warn") {
        spdlog::set_level(spdlog::level::warn);
    } else if (log_level == "error") {
        spdlog::set_level(spdlog::level::err);
    } else if (log_level == "critical") {
        spdlog::set_level(spdlog::level::critical);
    } else {
        std::cerr << "Invalid log level: " << log_level << std::endl;
        return 1;
    }

    spdlog::info("Starting My MCP Server");
    spdlog::info("Log level: {}", log_level);

    try {
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ graceful shutdown
        setup_signal_handlers();

        // –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
        auto core = std::make_shared<my_mcp::MyCore>();
        auto transport = std::make_unique<my_mcp::StdioTransport>();
        auto server = std::make_unique<my_mcp::MCPServer>(std::move(transport));

        // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–ª—è signal handler
        global_server = server.get();

        // –°–æ–∑–¥–∞—Ç—å –∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
        auto my_tool = std::make_shared<my_mcp::MyTool>(core);
        server->register_tool(
            my_mcp::MyTool::get_info(),
            [my_tool](const json& args) {
                return my_tool->execute(args);
            }
        );

        spdlog::info("All tools registered, starting server");

        // –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞ (–±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –¥–æ stop())
        server->run();

        global_server = nullptr;
        spdlog::info("Server stopped cleanly");
        return 0;

    } catch (const std::exception& e) {
        spdlog::critical("Fatal error: {}", e.what());
        return 1;
    }
}
```

### CMakeLists.txt - –°–±–æ—Ä–∫–∞

```cmake
cmake_minimum_required(VERSION 3.20)
project(my-mcp-server VERSION 1.0.0 LANGUAGES CXX)

set(CMAKE_CXX_STANDARD 20)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
find_package(nlohmann_json REQUIRED)
find_package(spdlog REQUIRED)
find_package(CLI11 REQUIRED)

# –°–ª–æ–π 1: Core
add_library(my_core
    src/core/MyCore.cpp
)
target_include_directories(my_core PUBLIC src)
target_link_libraries(my_core PUBLIC nlohmann_json::nlohmann_json)

# –°–ª–æ–π 2: Protocol
add_library(my_protocol
    src/mcp/MCPServer.cpp
    src/mcp/StdioTransport.cpp
)
target_include_directories(my_protocol PUBLIC src)
target_link_libraries(my_protocol
    PUBLIC
        nlohmann_json::nlohmann_json
        spdlog::spdlog
)

# –°–ª–æ–π 3: Tools
add_library(my_tools
    src/tools/MyTool.cpp
)
target_include_directories(my_tools PUBLIC src)
target_link_libraries(my_tools
    PUBLIC
        my_core
        my_protocol
)

# –ò—Å–ø–æ–ª–Ω—è–µ–º—ã–π —Ñ–∞–π–ª
add_executable(my-mcp-server
    src/main_stdio.cpp
)
target_link_libraries(my-mcp-server
    PRIVATE
        my_tools
        CLI11::CLI11
        spdlog::spdlog
)

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞
install(TARGETS my-mcp-server
    RUNTIME DESTINATION bin
)
```

---

## –ü—Ä–∏–º–µ—Ä—ã –ö–æ–¥–∞

### –ü—Ä–∏–º–µ—Ä 1: –ü—Ä–æ—Å—Ç–æ–π –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç "echo"

```cpp
class EchoTool {
public:
    static ToolInfo get_info() {
        return {
            .name = "echo",
            .description = "Returns the input message",
            .input_schema = {
                {"type", "object"},
                {"properties", {
                    {"message", {
                        {"type", "string"},
                        {"description", "Message to echo"}
                    }}
                }},
                {"required", json::array({"message"})}
            }
        };
    }

    json execute(const json& args) {
        std::string message = args["message"];
        return {
            {"echo", message}
        };
    }
};
```

### –ü—Ä–∏–º–µ—Ä 2: –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —Å –ú–∞—Å—Å–∏–≤–∞–º–∏

```cpp
class SumTool {
public:
    static ToolInfo get_info() {
        return {
            .name = "sum",
            .description = "Sums an array of numbers",
            .input_schema = {
                {"type", "object"},
                {"properties", {
                    {"numbers", {
                        {"type", "array"},
                        {"items", {"type", "number"}},
                        {"description", "Array of numbers to sum"}
                    }}
                }},
                {"required", json::array({"numbers"})}
            }
        };
    }

    json execute(const json& args) {
        const auto& numbers = args["numbers"];
        double sum = 0.0;
        for (const auto& num : numbers) {
            sum += num.get<double>();
        }
        return {
            {"sum", sum},
            {"count", numbers.size()}
        };
    }
};
```

### –ü—Ä–∏–º–µ—Ä 3: –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —Å –§–∞–π–ª–æ–≤–æ–π –°–∏—Å—Ç–µ–º–æ–π

```cpp
class ListFilesTool {
public:
    static ToolInfo get_info() {
        return {
            .name = "list_files",
            .description = "Lists files in a directory",
            .input_schema = {
                {"type", "object"},
                {"properties", {
                    {"directory", {
                        {"type", "string"},
                        {"description", "Directory path"}
                    }},
                    {"pattern", {
                        {"type", "string"},
                        {"description", "Glob pattern (e.g., *.txt)"},
                        {"default", "*"}
                    }}
                }},
                {"required", json::array({"directory"})}
            }
        };
    }

    json execute(const json& args) {
        std::filesystem::path dir = args["directory"];
        std::string pattern = args.value("pattern", "*");

        json files = json::array();

        for (const auto& entry : std::filesystem::directory_iterator(dir)) {
            if (entry.is_regular_file()) {
                // –ü—Ä–æ—Å—Ç–∞—è glob –ø—Ä–æ–≤–µ—Ä–∫–∞
                if (pattern == "*" || entry.path().filename().string().find(pattern) != std::string::npos) {
                    files.push_back({
                        {"path", entry.path().string()},
                        {"size", entry.file_size()}
                    });
                }
            }
        }

        return {
            {"files", files},
            {"count", files.size()},
            {"directory", dir.string()}
        };
    }
};
```

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –†—É—á–Ω–æ–µ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ Echo

```bash
# –¢–µ—Å—Ç 1: Initialize
echo '{
  "jsonrpc":"2.0",
  "id":1,
  "method":"initialize",
  "params":{
    "protocolVersion":"2024-11-05",
    "clientInfo":{"name":"test","version":"1.0"}
  }
}' | ./my-mcp-server --log-level error

# –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
# {"id":1,"jsonrpc":"2.0","result":{...}}

# –¢–µ—Å—Ç 2: Tools List
echo '{
  "jsonrpc":"2.0",
  "id":2,
  "method":"tools/list",
  "params":{}
}' | ./my-mcp-server --log-level error

# –¢–µ—Å—Ç 3: Tools Call
echo '{
  "jsonrpc":"2.0",
  "id":3,
  "method":"tools/call",
  "params":{
    "name":"my_tool",
    "arguments":{"filepath":"/tmp/test.txt"}
  }
}' | ./my-mcp-server --log-level error
```

### Unit-—Ç–µ—Å—Ç—ã —Å GTest

```cpp
#include <gtest/gtest.h>
#include "mcp/MCPServer.hpp"
#include "mcp/MockTransport.hpp"

TEST(MCPServerTest, Initialize) {
    auto transport = std::make_unique<MockTransport>();
    MCPServer server(std::move(transport));

    json request = {
        {"jsonrpc", "2.0"},
        {"id", 1},
        {"method", "initialize"},
        {"params", {
            {"protocolVersion", "2024-11-05"}
        }}
    };

    json response = server.handle_request(request);

    EXPECT_EQ(response["jsonrpc"], "2.0");
    EXPECT_EQ(response["id"], 1);
    EXPECT_TRUE(response.contains("result"));
    EXPECT_EQ(response["result"]["protocolVersion"], "2024-11-05");
}

TEST(MCPServerTest, ToolsList) {
    auto transport = std::make_unique<MockTransport>();
    MCPServer server(std::move(transport));

    // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
    server.register_tool(
        {"test_tool", "Test", json::object()},
        [](const json& args) { return json::object(); }
    );

    json request = {
        {"jsonrpc", "2.0"},
        {"id", 2},
        {"method", "tools/list"},
        {"params", {}}
    };

    json response = server.handle_request(request);

    EXPECT_TRUE(response["result"].contains("tools"));
    EXPECT_EQ(response["result"]["tools"].size(), 1);
    EXPECT_EQ(response["result"]["tools"][0]["name"], "test_tool");
}
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –¢–µ—Å—Ç

```bash
#!/bin/bash
# test_integration.sh

set -e

SERVER="./my-mcp-server"

echo "Test 1: Initialize handshake"
RESULT=$(echo '{"jsonrpc":"2.0","id":1,"method":"initialize","params":{}}' | $SERVER --log-level error)
echo "$RESULT" | grep -q '"protocolVersion":"2024-11-05"' || {
    echo "FAILED: Initialize"
    exit 1
}
echo "PASSED: Initialize"

echo "Test 2: Tools list"
RESULT=$(echo '{"jsonrpc":"2.0","id":2,"method":"tools/list","params":{}}' | $SERVER --log-level error)
echo "$RESULT" | grep -q '"tools"' || {
    echo "FAILED: Tools list"
    exit 1
}
echo "PASSED: Tools list"

echo "All tests passed!"
```

---

## –ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è –°–æ–∑–¥–∞–Ω–∏—è MCP –°–µ—Ä–≤–µ—Ä–∞

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

- [ ] **ITransport –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å** —Å read_message/write_message
- [ ] **StdioTransport —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è** (stdin/stdout)
- [ ] **MCPServer –∫–ª–∞—Å—Å** —Å –º–µ—Ç–æ–¥–∞–º–∏:
  - [ ] `handle_initialize()` - –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û!
  - [ ] `handle_initialized_notification()` - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
  - [ ] `handle_tools_list()` - —Å–ø–∏—Å–æ–∫ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
  - [ ] `handle_tools_call()` - –≤—ã–∑–æ–≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
  - [ ] `create_error_response()` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- [ ] **ToolInfo —Å—Ç—Ä—É–∫—Ç—É—Ä–∞** —Å name, description, input_schema
- [ ] **–•–æ—Ç—è –±—ã –æ–¥–∏–Ω –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç** —Å get_info() –∏ execute()
- [ ] **main_stdio.cpp** —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–µ–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
- [ ] **CMakeLists.txt** —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏
- [ ] **.mcp.json** –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Claude Code

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

- [ ] –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **spdlog** –∏–ª–∏ –∞–Ω–∞–ª–æ–≥
- [ ] –õ–æ–≥–∏ –∏–¥—É—Ç –≤ **stderr**, –ù–ï –≤ stdout
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —É—Ä–æ–≤–Ω–µ–π: trace, debug, info, warn, error, critical
- [ ] CLI —Ñ–ª–∞–≥ `--log-level` –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### JSON-RPC 2.0

- [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–ª—è `"jsonrpc": "2.0"`
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ `"id"` (–º–æ–∂–µ—Ç –±—ã—Ç—å null –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π)
- [ ] –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∫–æ–¥—ã –æ—à–∏–±–æ–∫ (-32601, -32600, etc.)
- [ ] –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞: `{"jsonrpc":"2.0","id":X,"result":{...}}`
- [ ] –§–æ—Ä–º–∞—Ç –æ—à–∏–±–∫–∏: `{"jsonrpc":"2.0","id":X,"error":{...}}`

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

- [ ] Unit-—Ç–µ—Å—Ç—ã –¥–ª—è MCPServer
- [ ] Unit-—Ç–µ—Å—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç —á–µ—Ä–µ–∑ bash —Å–∫—Ä–∏–ø—Ç
- [ ] –¢–µ—Å—Ç handshake (initialize ‚Üí initialized)
- [ ] –¢–µ—Å—Ç —Å —Ä–µ–∞–ª—å–Ω—ã–º Claude Code

---

## –ß–∞—Å—Ç—ã–µ –û—à–∏–±–∫–∏ –∏ –†–µ—à–µ–Ω–∏—è

### –û—à–∏–±–∫–∞ 1: "Method not found: initialize"

**–°–∏–º–ø—Ç–æ–º:**
```json
{"error":{"code":-32601,"message":"Method not found: initialize"}}
```

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –º–µ—Ç–æ–¥ `initialize` –≤ `handle_request()`

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫:
```cpp
if (method == "initialize") {
    json result = handle_initialize(params);
    return {{"jsonrpc", "2.0"}, {"id", id}, {"result", result}};
}
```

### –û—à–∏–±–∫–∞ 2: –°–µ—Ä–≤–µ—Ä –∑–∞–≤–∏—Å–∞–µ—Ç –ø–æ—Å–ª–µ initialize

**–ü—Ä–∏—á–∏–Ω–∞:** –ñ–¥—ë—Ç–µ –æ—Ç–≤–µ—Ç –Ω–∞ `notifications/initialized`, –Ω–æ —ç—Ç–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ

**–†–µ—à–µ–Ω–∏–µ:** –í–æ–∑–≤—Ä–∞—â–∞—Ç—å –ø—É—Å—Ç–æ–π JSON –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:
```cpp
if (method == "notifications/initialized") {
    handle_initialized_notification(params);
    return json();  // –ù–ï –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç–≤–µ—Ç!
}
```

### –û—à–∏–±–∫–∞ 3: –õ–æ–≥–∏ –º–µ—à–∞—é—Ç JSON –≤ stdout

**–ü—Ä–∏—á–∏–Ω–∞:** –õ–æ–≥–∏ –ø–∏—à—É—Ç—Å—è –≤ stdout –≤–º–µ—Å—Ç–æ stderr

**–†–µ—à–µ–Ω–∏–µ:** –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ spdlog –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ stderr:
```cpp
auto console_sink = std::make_shared<spdlog::sinks::stderr_color_sink_mt>();
```

### –û—à–∏–±–∫–∞ 4: Claude Code –Ω–µ –≤–∏–¥–∏—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ `tools/list`

**–†–µ—à–µ–Ω–∏–µ:** –§–æ—Ä–º–∞—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å:
```json
{
  "tools": [
    {
      "name": "...",
      "description": "...",
      "inputSchema": {...}
    }
  ]
}
```

### –û—à–∏–±–∫–∞ 5: –ê—Ä–≥—É–º–µ–Ω—Ç—ã –Ω–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç

**–ü—Ä–∏—á–∏–Ω–∞:** tools/call —Ç—Ä–µ–±—É–µ—Ç "arguments" –≤ params

**–†–µ—à–µ–Ω–∏–µ:**
```cpp
json arguments = params.value("arguments", json::object());
```

---

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –†–µ—Å—É—Ä—Å—ã

### –û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **MCP Specification**: https://spec.modelcontextprotocol.io/
- **MCP GitHub**: https://github.com/modelcontextprotocol
- **Claude Code Docs**: https://docs.claude.com/en/docs/claude-code/mcp

### –ü—Ä–∏–º–µ—Ä—ã –†–µ–∞–ª–∏–∑–∞—Ü–∏–π

- **TypeScript SDK**: https://github.com/modelcontextprotocol/typescript-sdk
- **Python SDK**: https://github.com/modelcontextprotocol/python-sdk
- **Reference Servers**: https://github.com/modelcontextprotocol/servers

### –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

- **JSON Schema Validator**: https://www.jsonschemavalidator.net/
- **JSON-RPC Tester**: https://www.jsonrpc.org/

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

### –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –†–∞–±–æ—á–∞—è –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

–î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ—Å—Ç–µ–π—à–µ–≥–æ MCP —Å–µ—Ä–≤–µ—Ä–∞ –≤–∞–º –Ω—É–∂–Ω–æ:

1. **~200 —Å—Ç—Ä–æ–∫** –¥–ª—è ITransport –∏ StdioTransport
2. **~300 —Å—Ç—Ä–æ–∫** –¥–ª—è MCPServer —Å initialize/tools
3. **~100 —Å—Ç—Ä–æ–∫** –Ω–∞ –∫–∞–∂–¥—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç
4. **~50 —Å—Ç—Ä–æ–∫** –¥–ª—è main_stdio.cpp

**–ò—Ç–æ–≥–æ: ~650 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞** –¥–ª—è –±–∞–∑–æ–≤–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ MCP —Å–µ—Ä–≤–µ—Ä–∞!

### –°–ª–µ–¥—É—é—â–∏–µ –®–∞–≥–∏

1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏–∑ —ç—Ç–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞
2. –†–µ–∞–ª–∏–∑—É–π—Ç–µ —Å–≤–æ—é –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –≤ `src/core/`
3. –°–æ–∑–¥–∞–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –≤ `src/tools/`
4. –°–æ–±–µ—Ä–∏—Ç–µ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ
5. –î–æ–±–∞–≤—å—Ç–µ `.mcp.json` –≤ –≤–∞—à –ø—Ä–æ–µ–∫—Ç
6. –ó–∞–ø—É—Å—Ç–∏—Ç–µ Claude Code –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ `/mcp`

### –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

–ü–æ—Å–ª–µ –±–∞–∑–æ–≤–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:

- **Resources**: –î–ª—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö AI
- **Prompts**: –î–ª—è —à–∞–±–ª–æ–Ω–æ–≤ –∑–∞–ø—Ä–æ—Å–æ–≤
- **HTTP/SSE Transport**: –î–ª—è –≤–µ–±-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π
- **WebSocket Transport**: –î–ª—è real-time –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏
- **Streaming**: –î–ª—è –±–æ–ª—å—à–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- **Progress notifications**: –î–ª—è –¥–ª–∏—Ç–µ–ª—å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

---

**–£–¥–∞—á–∏ –≤ —Å–æ–∑–¥–∞–Ω–∏–∏ –≤–∞—à–µ–≥–æ MCP —Å–µ—Ä–≤–µ—Ä–∞! üöÄ**

–ï—Å–ª–∏ —É –≤–∞—Å –≤–æ–∑–Ω–∏–∫–Ω—É—Ç –≤–æ–ø—Ä–æ—Å—ã, –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫:
- –≠—Ç–æ–º—É –¥–æ–∫—É–º–µ–Ω—Ç—É
- [MCP API Reference](MCP_API_REFERENCE.md)
- [–ò—Å—Ö–æ–¥–Ω–æ–º—É –∫–æ–¥—É tree-sitter-mcp](../src/)
